@model IEnumerable<SAcademy.Models.Formation>

@{
    ViewData["Title"] = "Index";
}
@await Component.InvokeAsync("FormationPage")
<nav aria-label="breadcrumb">
    <ol class="breadcrumb bg-transparent pl-5">
        <li class="breadcrumb-item text-center pl-2"><a href="/"><img class="w-75" src="~/img/home.png"></a></li>
        <li class="breadcrumb-item active" aria-current="page">Nos Formation</li>
    </ol>
</nav>
<div class="container">

    <div class="row p-4">
        <div class="col-3" id="accordion">
            <div class="card border-0 w-75">
                <h3>Filtrer Par</h3>
                <hr class="w-75 p-0" />
                <div class="card-header bg-transparent border-0 pl-0" id="headingOne">
                    <h5 class="mb-0">
                        <button class="border-0 bg-transparent" style="font-size:26px;" data-toggle="collapse"
                            data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                            <span class="pr-5 text-dark">Type</span>
                            <img class="" style="width:26px; margin-left:2.4em;" src="~/img/arrow.png" />
                        </button>
                    </h5>
                </div>

                <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordion">
                    <div class="card-body">
                        <div class="" id="ftype"></div>
                    </div>
                </div>
                <hr class="w-75 p-0" />
            </div>
            <div class="card border-0 w-75">
                <div class="card-header bg-transparent border-0 pl-0" id="headingTwo">
                    <h5 class="mb-0">
                        <button class="border-0 bg-transparent" style="font-size:26px; " data-toggle="collapse"
                            data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                            <span class="pr-5 text-dark">Ville</span>
                            <img class="" style="width:26px; margin-left:2.7em;" src="~/img/arrow.png" />
                        </button>
                    </h5>
                </div>
                <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion">
                    <div class="card-body">
                        <div id="villes"></div>
                    </div>
                </div>
                <hr class="w-75 p-0" />
            </div>
            <div class="card border-0 w-75">
                <div class="card-header bg-transparent border-0 pl-0" id="headingThree">
                    <h5 class="mb-0">
                        <button class="border-0 bg-transparent" style="font-size:26px;" data-toggle="collapse"
                            data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                            <span class="pr-5 text-dark">Mode</span>
                            <img class="" style="width:26px; margin-left:2em;" src="~/img/arrow.png" />
                        </button>
                    </h5>
                </div>
                <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordion">
                    <div class="card-body">
                        <div id="modes"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-9 float-right p-3">
            @{
                string result = null;
                if (Model.Count() > 0)
                {
                    result = "nombre de formation disponible actuellement : " + " " + Model.Count().ToString();
                }
                else
                {
                    result = "Aucune Formation pour l'instant";
                }
            }
            <h5>@result</h5>
            <div id="formation"></div>
        </div>
    </div>

</div>
@* @{
    var date = @Html.DisplayFor(modelItem => Model.StartDay);
    } *@


<script defer>




    $.ajax({
        url: '/Villes/GetVilleAPI',
        type: 'GET',
        success: function (res) {
            $.each(res, function (index, option) {
                $("#villes").append(
                    `
                        <div class="d-flex">
                                <input type="checkbox" style="width:26px;" class="villeId common" name="villes" onClick="filterFormations()" value="${option.id}"> <span class="pl-4" style="font-size:26px;">${option.name}</span>
                        </div>
                    `
                );
            });
        }
    });

    $.ajax({
        url: '/FTypes/GetTypeAPI',
        type: 'GET',
        success: function (res) {
            $.each(res, function (index, option) {
                $("#ftype").append(
                    `
                        <div class="d-flex">
                                        <input type="checkbox"  style="width:26px;" class="typeId common" name="types" onClick="filterFormations()" value="${option.id}"> <span class="pl-4" style="font-size:26px;">${option.name}</span>
                        </div>
                    `
                );
            });
        }
    });


    $.ajax({
        url: '/Modes/GetModeAPI',
        type: 'GET',
        success: function (res) {
            $.each(res, function (index, option) {
                $("#modes").append(
                    `
                        <div class="d-flex">
                                            <input type="checkbox" style="width:26px;" class="modeId common" name="modes" onClick="filterFormations()" value="${option.id}"> <span class="pl-4"  style="font-size:26px;">${option.name}</span>
                        </div>
                    `
                );
            });
        }
    });





    filterFormations();

    $('.common').click(function () {
        filterFormations();
    });
    function filterFormations() {

        //debugger
        var modes = get_filter('modeId');
        var types = get_filter('typeId');
        var villes = get_filter('villeId');

        $.ajax({
            url: '/Formations/Filter',
            type: 'GET',
            data: {
                modeId: modes?.join(','),
                typeId: types?.join(','),
                villeId: villes?.join(','),
            },
            success: function (data) {
                 
                console.log(data)
                if (data && data.length > 0) {
                    $("#formation").html('') 
                    $.each(data, function (index, option) {
                        var ds = option.startDay.toString().split('T')[0];
                        var de = option.endDay.toString().split('T')[0];
                        var time1 = option.startTime;
                        var time2 = option.endTime;
                        var st = new Date(time1).toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/, "$1");
                        var et = new Date(time2).toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/, "$1");
                        $("#formation").append(
                            `
                                <div class="row formation p-3 mb-3 w-100 float-right">
                                        <div class="col-3 p-2 text-center">
                                            <img src="/img/time.png" style="width:3em;"/>
                                            <h5>${ds}<span class="text-muted"> => </span><br/>${de}</h5>
                                            <h6>${st} => ${et}</h6>
                                            <img src="/img/iconForm1.png" style="width:3em;"/>
                                            <img src="/img/iconForm2.png" style="width:3em;"/>
                                            <img src="/img/iconForm4.png" style="width:3em;"/>
                                        </div>
                                        <div class="col-6 p-2 w-50 text-center">
                                            <h5>${option.title}</h5>
                                            <p class="descFormation">${option.description}</p>
                                            <h5><span class="text-muted">ville: </span>${option.ville.name}</h5>
                                        </div>
                                            <div class="col-3 p-2 text-center">
                                            <img src="/img/iconForm3.png" style="width:3em;"/>
                                            <h5>${option.type.name}</h5>
                                            <h6 class="mb-4">${option.mode.name}</h6>
                                            <a href="formations/details/${option.id}" class=" inscription">Inscription</a>
                                        </div>
                                </div>
                        `
                        );
                    });
                } else {
                    $("#formation").append(
                        `
                                <div class="col-3 m-2 p-3" >

                                </div>
                            `
                    );
                }

            }
        });
    }


    function get_filter(class_name) {
        var filter = [];
        $('.' + class_name + ':checked').each(function () {
            filter.push($(this).val());
        });
        return filter;
    }






</script>